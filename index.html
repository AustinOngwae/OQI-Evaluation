<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Urban Planner's Aedes Action Tool - UN-HABITAT</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.1/html2pdf.bundle.min.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
      body {
        font-family: 'Inter', sans-serif;
      }
      .form-section {
        display: none;
      }
      .form-section.active {
        display: block;
      }
      /* Custom checkbox and radio styles */
      .custom-radio:checked {
        background-color: #0891b2; /* cyan-600 */
        background-image: url("data:image/svg+xml,%3csvg viewBox='0 0 16 16' fill='white' xmlns='http://www.w3.org/2000/svg'%3e%3ccircle cx='8' cy='8' r='3'/%3e%3c/svg%3e");
      }
      .custom-checkbox:checked {
        background-color: #0891b2; /* cyan-600 */
        background-image: url("data:image/svg+xml,%3csvg viewBox='0 0 16 16' fill='white' xmlns='http://www.w3.org/2000/svg'%3e%3cpath d='M12.207 4.793a1 1 0 010 1.414l-5 5a1 1 0 01-1.414 0l-2-2a1 1 0 011.414-1.414L6.5 9.086l4.293-4.293a1 1 0 011.414 0z'/%3e%3c/svg%3e");
      }
      .checklist-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
        gap: 1rem;
      }
      @media print {
        body * {
          visibility: hidden;
        }
        #results-printable, #results-printable * {
          visibility: visible;
        }
        #results-printable {
          position: absolute;
          left: 0;
          top: 0;
          width: 100%;
        }
        #navigation, #header-main, #restart-btn-container {
          display: none;
        }
        .no-print {
          display: none !important;
        }
      }
      .pdf-content {
        background: white;
        padding: 40px;
        margin: 0;
        font-family: 'Inter', Arial, sans-serif;
      }
      .pdf-content h1, .pdf-content h2, .pdf-content h3 {
        color: #0891b2;
        margin-bottom: 16px;
      }
      .pdf-content .benefit-item {
        display: inline-block;
        margin: 8px;
        padding: 12px;
        background: #f3f4f6;
        border-radius: 8px;
        text-align: center;
      }
    </style>
  </head>
  <body class="bg-gray-100 text-gray-800">
    <div class="container mx-auto px-4 py-8 md:py-12 max-w-5xl">
      <header id="header-main" class="text-center mb-8">
        <div class="flex items-center justify-center mb-6">
          <img 
            src="https://quest-media-storage-bucket.s3.us-east-2.amazonaws.com/1759320275254-Logo-UN-Habitat.jpg" 
            alt="UN-HABITAT Logo" 
            class="h-20 w-auto mr-4"
          />
          <div class="text-left">
            <h1 class="text-3xl md:text-4xl font-bold text-cyan-700">Urban Planner's Aedes Action Tool</h1>
            <p class="text-lg text-gray-600 mt-1">UN-HABITAT Partnership Initiative</p>
          </div>
        </div>
        <p class="mt-2 text-lg text-gray-600">Integrate public health into your planning practice to design resilient, mosquito-free cities.</p>
      </header>

      <main id="app-container" class="bg-white p-6 md:p-8 rounded-2xl shadow-lg">
        <form id="planner-form">
          <!-- Step 1: Planning Context -->
          <div id="step-1" class="form-section active">
            <h2 class="text-2xl font-semibold mb-2 text-cyan-600">Step 1: Planning Context & Health Risk</h2>
            <p class="mb-6 text-gray-500">Define the scope of your work and the local public health context.</p>
            
            <h3 class="font-semibold text-gray-700 mb-3">What is the primary focus of your current planning effort?</h3>
            <div class="space-y-4 mb-8">
              <label class="flex items-center p-4 border rounded-lg cursor-pointer hover:bg-cyan-50 transition-colors">
                <input type="radio" name="planning_focus" value="new_development" class="h-5 w-5 custom-radio border-gray-300 text-cyan-600 focus:ring-cyan-500" required>
                <span class="ml-4">
                  <strong class="font-semibold block">New Development / Master Plan</strong>
                  <span class="text-sm text-gray-500">Designing a new district or large-scale project.</span>
                </span>
              </label>
              <label class="flex items-center p-4 border rounded-lg cursor-pointer hover:bg-cyan-50 transition-colors">
                <input type="radio" name="planning_focus" value="retrofitting" class="h-5 w-5 custom-radio border-gray-300 text-cyan-600 focus:ring-cyan-500">
                <span class="ml-4">
                  <strong class="font-semibold block">Retrofitting / Urban Regeneration</strong>
                  <span class="text-sm text-gray-500">Upgrading an existing neighborhood.</span>
                </span>
              </label>
              <label class="flex items-center p-4 border rounded-lg cursor-pointer hover:bg-cyan-50 transition-colors">
                <input type="radio" name="planning_focus" value="policy" class="h-5 w-5 custom-radio border-gray-300 text-cyan-600 focus:ring-cyan-500">
                <span class="ml-4">
                  <strong class="font-semibold block">City-Wide Policy & Zoning</strong>
                  <span class="text-sm text-gray-500">Developing comprehensive plans or codes.</span>
                </span>
              </label>
            </div>

            <h3 class="font-semibold text-gray-700 mb-3">What is the current Aedes-borne disease situation?</h3>
            <select name="transmission_level" class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-cyan-500 focus:border-cyan-500" required>
              <option value="" disabled selected>-- Please select an option --</option>
              <option value="epidemic">Epidemic Transmission (Regular, large-scale outbreaks)</option>
              <option value="seasonal">Regular Seasonal Transmission (Predictable annual increases)</option>
              <option value="sporadic">Sporadic Transmission (Occasional, isolated cases)</option>
              <option value="present_no_local">Aedes Present, No Local Transmission (Vector is present)</option>
              <option value="no_aedes">No Aedes present (Preventative planning)</option>
            </select>
          </div>

          <!-- Step 2: Regional Context & Capacity -->
          <div id="step-2" class="form-section">
            <h2 class="text-2xl font-semibold mb-2 text-cyan-600">Step 2: Regional Context & Capacity</h2>
            <p class="mb-6 text-gray-500">Detail your region, budget, and existing assets to tailor the plan.</p>
            
            <h3 class="font-semibold text-gray-700 mb-3">Which region best describes your planning area?</h3>
            <select name="region" class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-cyan-500 focus:border-cyan-500 mb-8" required>
              <option value="" disabled selected>-- Please select a region --</option>
              <option value="asia_pacific">Asia-Pacific</option>
              <option value="americas">The Americas (South, Central, North)</option>
              <option value="africa">Africa</option>
              <option value="europe_middle_east">Europe / Middle East (areas with emerging risk)</option>
            </select>

            <h3 class="font-semibold text-gray-700 mb-3">What is the approximate budget for this initiative?</h3>
            <div class="space-y-4 mb-8">
              <label class="flex items-center p-4 border rounded-lg cursor-pointer hover:bg-cyan-50 transition-colors">
                <input type="radio" name="budget" value="high" class="h-5 w-5 custom-radio border-gray-300 text-cyan-600 focus:ring-cyan-500" required>
                <span class="ml-4">
                  <strong class="font-semibold block">Well-funded</strong>
                  <span class="text-sm text-gray-500">Dedicated budget for capital projects and new programs.</span>
                </span>
              </label>
              <label class="flex items-center p-4 border rounded-lg cursor-pointer hover:bg-cyan-50 transition-colors">
                <input type="radio" name="budget" value="medium" class="h-5 w-5 custom-radio border-gray-300 text-cyan-600 focus:ring-cyan-500">
                <span class="ml-4">
                  <strong class="font-semibold block">Limited</strong>
                  <span class="text-sm text-gray-500">Funding for operational costs or small grants.</span>
                </span>
              </label>
              <label class="flex items-center p-4 border rounded-lg cursor-pointer hover:bg-cyan-50 transition-colors">
                <input type="radio" name="budget" value="low" class="h-5 w-5 custom-radio border-gray-300 text-cyan-600 focus:ring-cyan-500">
                <span class="ml-4">
                  <strong class="font-semibold block">Minimal / Unfunded</strong>
                  <span class="text-sm text-gray-500">Must rely on existing resources and no-cost policy changes.</span>
                </span>
              </label>
            </div>
          </div>

          <!-- Step 3: Integrated Control Audit -->
          <div id="step-3" class="form-section">
            <h2 class="text-2xl font-semibold mb-2 text-cyan-600">Step 3: Integrated Control Audit</h2>
            <p class="mb-6 text-gray-500">Indicate which of the following health-sector activities are currently implemented effectively in your area.</p>
            
            <div class="space-y-6">
              <div>
                <h3 class="font-semibold text-gray-700 mb-3">Vector Control</h3>
                <div class="checklist-grid">
                  <label class="flex items-start p-3 border rounded-lg cursor-pointer hover:bg-cyan-50">
                    <input type="checkbox" name="implemented" value="vc_optimize" class="h-5 w-5 mt-1 custom-checkbox rounded border-gray-300">
                    <span class="ml-3">
                      <strong class="block">Optimized Existing Programme</strong>
                      <span class="text-sm text-gray-500">Maximized coverage and effectiveness.</span>
                    </span>
                  </label>
                  <label class="flex items-start p-3 border rounded-lg cursor-pointer hover:bg-cyan-50">
                    <input type="checkbox" name="implemented" value="vc_novel" class="h-5 w-5 mt-1 custom-checkbox rounded border-gray-300">
                    <span class="ml-3">
                      <strong class="block">Novel Vector Control</strong>
                      <span class="text-sm text-gray-500">e.g., Wolbachia, TIRS implemented at scale.</span>
                    </span>
                  </label>
                </div>
              </div>

              <div>
                <h3 class="font-semibold text-gray-700 mb-3">Disease Prevention</h3>
                <div class="checklist-grid">
                  <label class="flex items-start p-3 border rounded-lg cursor-pointer hover:bg-cyan-50">
                    <input type="checkbox" name="implemented" value="dp_training" class="h-5 w-5 mt-1 custom-checkbox rounded border-gray-300">
                    <span class="ml-3">
                      <strong class="block">Physician Training</strong>
                      <span class="text-sm text-gray-500">Regular training in clinical management.</span>
                    </span>
                  </label>
                  <label class="flex items-start p-3 border rounded-lg cursor-pointer hover:bg-cyan-50">
                    <input type="checkbox" name="implemented" value="dp_vaccination" class="h-5 w-5 mt-1 custom-checkbox rounded border-gray-300">
                    <span class="ml-3">
                      <strong class="block">Routine & Adaptive Vaccination</strong>
                      <span class="text-sm text-gray-500">Vaccine programs are in place.</span>
                    </span>
                  </label>
                </div>
              </div>

              <div>
                <h3 class="font-semibold text-gray-700 mb-3">Integrated Surveillance & Evaluation</h3>
                <div class="checklist-grid">
                  <label class="flex items-start p-3 border rounded-lg cursor-pointer hover:bg-cyan-50">
                    <input type="checkbox" name="implemented" value="is_realtime" class="h-5 w-5 mt-1 custom-checkbox rounded border-gray-300">
                    <span class="ml-3">
                      <strong class="block">Real-time Case Monitoring</strong>
                      <span class="text-sm text-gray-500">Detect and monitor dengue cases rapidly.</span>
                    </span>
                  </label>
                  <label class="flex items-start p-3 border rounded-lg cursor-pointer hover:bg-cyan-50">
                    <input type="checkbox" name="implemented" value="is_aedes_dynamics" class="h-5 w-5 mt-1 custom-checkbox rounded border-gray-300">
                    <span class="ml-3">
                      <strong class="block">Aedes Population Dynamics</strong>
                      <span class="text-sm text-gray-500">Monitoring of mosquito populations.</span>
                    </span>
                  </label>
                  <label class="flex items-start p-3 border rounded-lg cursor-pointer hover:bg-cyan-50">
                    <input type="checkbox" name="implemented" value="is_resistance" class="h-5 w-5 mt-1 custom-checkbox rounded border-gray-300">
                    <span class="ml-3">
                      <strong class="block">Resistance Monitoring</strong>
                      <span class="text-sm text-gray-500">Insecticide, Wolbachia resistance, etc.</span>
                    </span>
                  </label>
                  <label class="flex items-start p-3 border rounded-lg cursor-pointer hover:bg-cyan-50">
                    <input type="checkbox" name="implemented" value="me_effectiveness" class="h-5 w-5 mt-1 custom-checkbox rounded border-gray-300">
                    <span class="ml-3">
                      <strong class="block">Measure Effectiveness</strong>
                      <span class="text-sm text-gray-500">Routinely measure effectiveness of control.</span>
                    </span>
                  </label>
                </div>
              </div>
            </div>
          </div>

          <!-- Step 4: Urban Environment Policy Audit -->
          <div id="step-4" class="form-section">
            <h2 class="text-2xl font-semibold mb-2 text-cyan-600">Step 4: Urban Environment Policy Audit</h2>
            <p class="mb-6 text-gray-500">Indicate which of the following urban environment policies and programs are currently implemented.</p>
            
            <div class="space-y-6">
              <div>
                <h3 class="font-semibold text-gray-700 mb-3">Planning & Regulation</h3>
                <div class="checklist-grid">
                  <label class="flex items-start p-3 border rounded-lg cursor-pointer hover:bg-cyan-50">
                    <input type="checkbox" name="implemented" value="pr_construction" class="h-5 w-5 mt-1 custom-checkbox rounded border-gray-300">
                    <span class="ml-3">
                      <strong class="block">Changed Construction Practices</strong>
                      <span class="text-sm text-gray-500">Short-term regulations in place.</span>
                    </span>
                  </label>
                  <label class="flex items-start p-3 border rounded-lg cursor-pointer hover:bg-cyan-50">
                    <input type="checkbox" name="implemented" value="pr_design" class="h-5 w-5 mt-1 custom-checkbox rounded border-gray-300">
                    <span class="ml-3">
                      <strong class="block">Changed Design Practices</strong>
                      <span class="text-sm text-gray-500">Medium-term design codes updated.</span>
                    </span>
                  </label>
                  <label class="flex items-start p-3 border rounded-lg cursor-pointer hover:bg-cyan-50">
                    <input type="checkbox" name="implemented" value="pr_integrate" class="h-5 w-5 mt-1 custom-checkbox rounded border-gray-300">
                    <span class="ml-3">
                      <strong class="block">Integrated Aedes Prevention</strong>
                      <span class="text-sm text-gray-500">Long-term integration into city plan.</span>
                    </span>
                  </label>
                </div>
              </div>

              <div>
                <h3 class="font-semibold text-gray-700 mb-3">Urban Services</h3>
                <div class="checklist-grid">
                  <label class="flex items-start p-3 border rounded-lg cursor-pointer hover:bg-cyan-50">
                    <input type="checkbox" name="implemented" value="us_waste" class="h-5 w-5 mt-1 custom-checkbox rounded border-gray-300">
                    <span class="ml-3">
                      <strong class="block">Improved Solid Waste Collection</strong>
                      <span class="text-sm text-gray-500">Effective, regular service in place.</span>
                    </span>
                  </label>
                  <label class="flex items-start p-3 border rounded-lg cursor-pointer hover:bg-cyan-50">
                    <input type="checkbox" name="implemented" value="us_water" class="h-5 w-5 mt-1 custom-checkbox rounded border-gray-300">
                    <span class="ml-3">
                      <strong class="block">Consistent Piped Water</strong>
                      <span class="text-sm text-gray-500">Reliable supply reduces water storage.</span>
                    </span>
                  </label>
                  <label class="flex items-start p-3 border rounded-lg cursor-pointer hover:bg-cyan-50">
                    <input type="checkbox" name="implemented" value="us_drainage" class="h-5 w-5 mt-1 custom-checkbox rounded border-gray-300">
                    <span class="ml-3">
                      <strong class="block">Effective Drainage Systems</strong>
                      <span class="text-sm text-gray-500">City-wide effective drainage.</span>
                    </span>
                  </label>
                </div>
              </div>

              <div>
                <h3 class="font-semibold text-gray-700 mb-3">Social & Governmental Collaboration</h3>
                <div class="checklist-grid">
                  <label class="flex items-start p-3 border rounded-lg cursor-pointer hover:bg-cyan-50">
                    <input type="checkbox" name="implemented" value="sm_campaigns" class="h-5 w-5 mt-1 custom-checkbox rounded border-gray-300">
                    <span class="ml-3">
                      <strong class="block">Community Cleanup Campaigns</strong>
                      <span class="text-sm text-gray-500">Individual & community organized.</span>
                    </span>
                  </label>
                  <label class="flex items-start p-3 border rounded-lg cursor-pointer hover:bg-cyan-50">
                    <input type="checkbox" name="implemented" value="ms_communication" class="h-5 w-5 mt-1 custom-checkbox rounded border-gray-300">
                    <span class="ml-3">
                      <strong class="block">Inter-sectoral Communication</strong>
                      <span class="text-sm text-gray-500">Improved comms between sectors.</span>
                    </span>
                  </label>
                  <label class="flex items-start p-3 border rounded-lg cursor-pointer hover:bg-cyan-50">
                    <input type="checkbox" name="implemented" value="sm_ownership" class="h-5 w-5 mt-1 custom-checkbox rounded border-gray-300">
                    <span class="ml-3">
                      <strong class="block">Community-based Ownership</strong>
                      <span class="text-sm text-gray-500">Surveillance & program ownership.</span>
                    </span>
                  </label>
                  <label class="flex items-start p-3 border rounded-lg cursor-pointer hover:bg-cyan-50">
                    <input type="checkbox" name="implemented" value="ms_whole" class="h-5 w-5 mt-1 custom-checkbox rounded border-gray-300">
                    <span class="ml-3">
                      <strong class="block">"Whole of Government" Approach</strong>
                      <span class="text-sm text-gray-500">Integrated health/planning goals.</span>
                    </span>
                  </label>
                </div>
              </div>
            </div>
          </div>
        </form>

        <div id="navigation" class="mt-8 flex justify-between">
          <button id="prev-btn" class="bg-gray-200 text-gray-700 font-semibold py-2 px-6 rounded-lg hover:bg-gray-300 transition-colors disabled:opacity-50 disabled:cursor-not-allowed" disabled>Previous</button>
          <button id="next-btn" class="bg-cyan-600 text-white font-semibold py-2 px-6 rounded-lg hover:bg-cyan-700 transition-colors">Next</button>
          <button id="submit-btn" class="hidden bg-cyan-600 text-white font-bold py-3 px-8 rounded-lg hover:bg-cyan-700 transition-transform transform hover:scale-105">Generate Action Plan</button>
        </div>

        <div id="results-container" class="hidden">
          <!-- Results content will be injected by JavaScript -->
        </div>
      </main>

      <!-- UN-HABITAT Footer -->
      <footer class="text-center mt-8 text-sm text-gray-500">
        <p>Powered by UN-HABITAT ‚Ä¢ Supporting sustainable urban development worldwide</p>
      </footer>
    </div>

    <script>
      const app = {
        currentStep: 1,
        totalSteps: 4,
        form: document.getElementById('planner-form'),
        steps: document.querySelectorAll('.form-section'),
        prevBtn: document.getElementById('prev-btn'),
        nextBtn: document.getElementById('next-btn'),
        submitBtn: document.getElementById('submit-btn'),
        resultsContainer: document.getElementById('results-container'),

        init() {
          this.nextBtn.addEventListener('click', () => this.changeStep(1));
          this.prevBtn.addEventListener('click', () => this.changeStep(-1));
          this.submitBtn.addEventListener('click', (e) => {
            e.preventDefault();
            this.generatePlan();
          });
          this.updateButtons();
        },

        changeStep(direction) {
          const currentStepElement = document.getElementById(`step-${this.currentStep}`);
          const inputs = currentStepElement.querySelectorAll('input[required], select[required]');
          let isValid = true;

          inputs.forEach(input => {
            if (input.type === 'radio') {
              const radioGroup = document.querySelector(`input[name="${input.name}"]:checked`);
              if (!radioGroup) isValid = false;
            } else if (!input.value) {
              isValid = false;
            }
          });

          if (direction > 0 && !isValid) {
            this.showError('Please complete all required fields to continue.');
            return;
          }

          this.currentStep += direction;
          this.steps.forEach(step => step.classList.remove('active'));
          document.getElementById(`step-${this.currentStep}`).classList.add('active');
          this.updateButtons();
        },

        updateButtons() {
          this.prevBtn.disabled = this.currentStep === 1;
          this.nextBtn.classList.toggle('hidden', this.currentStep === this.totalSteps);
          this.submitBtn.classList.toggle('hidden', this.currentStep !== this.totalSteps);
        },

        showError(message) {
          let errorEl = document.getElementById('error-message');
          if (!errorEl) {
            errorEl = document.createElement('div');
            errorEl.id = 'error-message';
            errorEl.className = 'mt-4 text-center text-red-600 font-semibold p-3 bg-red-100 rounded-lg';
            document.getElementById('navigation').insertAdjacentElement('beforebegin', errorEl);
          }
          errorEl.textContent = message;
          setTimeout(() => errorEl.remove(), 3000);
        },

        async generatePlan() {
          document.getElementById('navigation').classList.add('hidden');
          document.getElementById('planner-form').classList.add('hidden');
          this.resultsContainer.classList.remove('hidden');

          this.resultsContainer.innerHTML = `
            <div class="text-center p-8">
              <div class="animate-spin rounded-full h-12 w-12 border-b-2 border-cyan-600 mx-auto"></div>
              <p class="mt-4 text-gray-600">Analyzing your inputs and generating a tailored plan...</p>
            </div>
          `;

          const formData = new FormData(this.form);
          const data = {
            planning_focus: formData.get('planning_focus'),
            transmission_level: formData.get('transmission_level'),
            region: formData.get('region'),
            budget: formData.get('budget'),
            implemented: formData.getAll('implemented'),
          };

          const recommendations = this.getRecommendations(data);
          this.displayResults(recommendations, data);
        },

        getRecommendations(data) {
          const recs = {
            strategic_notes: [],
            policy: [],
            design: [],
            collaboration: [],
            coBenefits: new Set()
          };

          // Add strategic notes based on context
          if (data.region === 'africa') {
            recs.strategic_notes.push({
              title: 'Preventive Opportunity for Africa',
              text: 'Africa may be in the earlier stages of dengue emergence. Proactive urban planning now is critical to prevent large-scale epidemics. Your efforts have generational impact potential.'
            });
          }

          if (data.budget === 'low') {
            recs.strategic_notes.push({
              title: 'Focus on Policy and Collaboration',
              text: 'With limited budget, prioritize no-cost policy changes and inter-sectoral collaboration. These foundational changes can be highly effective and build the case for future infrastructure investment.'
            });
          }

          // Add sample recommendations
          recs.policy.push({
            title: 'Update Construction Site Water Management',
            text: 'Implement regulations requiring developers to prevent water accumulation during construction. This is a high-impact, low-cost policy intervention.',
            benefits: ['Health', 'Institutional']
          });

          recs.collaboration.push({
            title: 'Establish Health-Planning Task Force',
            text: 'Create formal coordination between planning, public works, health, and environment departments with regular meetings and shared objectives.',
            benefits: ['Institutional']
          });

          if (data.budget !== 'low') {
            recs.design.push({
              title: 'Integrate Drainage Infrastructure',
              text: 'Plan comprehensive stormwater management systems that eliminate standing water while supporting urban resilience.',
              benefits: ['Health', 'Environment']
            });
          }

          // Calculate co-benefits
          [...recs.policy, ...recs.design, ...recs.collaboration].forEach(rec => {
            if (rec.benefits) {
              rec.benefits.forEach(benefit => recs.coBenefits.add(benefit));
            }
          });

          return recs;
        },

        displayResults(recs, data) {
          const benefitsMap = {
            'Health': { icon: '‚ù§Ô∏è', text: 'Health & Well-being' },
            'Economy': { icon: 'üí∞', text: 'Economic Growth' },
            'Environment': { icon: 'üå≥', text: 'Urban Environment' },
            'Social': { icon: 'ü§ù', text: 'Community & Equity' },
            'Institutional': { icon: 'üèõÔ∏è', text: 'Governance' }
          };

          let benefitsHtml = '<div class="grid grid-cols-2 sm:grid-cols-3 lg:grid-cols-5 gap-4">';
          recs.coBenefits.forEach(benefit => {
            benefitsHtml += `
              <div class="text-center p-3 bg-gray-100 rounded-lg benefit-item">
                <span class="text-2xl">${benefitsMap[benefit].icon}</span>
                <p class="text-sm font-medium mt-1">${benefitsMap[benefit].text}</p>
              </div>
            `;
          });
          benefitsHtml += '</div>';

          const generateSectionHtml = (title, recommendations) => {
            if (!recommendations || recommendations.length === 0) return '';
            let html = `
              <h3 class="text-2xl font-bold text-cyan-700 mt-8 mb-4 border-b-2 border-cyan-200 pb-2">${title}</h3>
              <div class="space-y-4">
            `;
            recommendations.forEach(rec => {
              html += `
                <div class="bg-gray-50 p-4 rounded-lg border border-gray-200">
                  <h4 class="font-semibold text-lg text-gray-800">${rec.title}</h4>
                  <p class="text-gray-600 mt-1">${rec.text}</p>
                </div>
              `;
            });
            return html + '</div>';
          };

          this.resultsContainer.innerHTML = `
            <div id="results-printable" class="pdf-content">
              <div class="text-center border-b border-gray-200 pb-6 mb-8">
                <div class="flex items-center justify-center mb-4">
                  <img 
                    src="https://quest-media-storage-bucket.s3.us-east-2.amazonaws.com/1759320275254-Logo-UN-Habitat.jpg" 
                    alt="UN-HABITAT Logo" 
                    class="h-16 w-auto mr-4"
                  />
                  <div>
                    <h1 class="text-3xl font-bold text-cyan-600">Urban Planner's Action Plan</h1>
                    <p class="text-sm text-gray-500">UN-HABITAT Partnership Initiative</p>
                  </div>
                </div>
                <p class="mt-2 text-gray-600">
                  A prioritized action plan for your <strong class="text-cyan-700">${data.planning_focus.replace(/_/g, ' ')}</strong> project.
                </p>
                <p class="text-sm text-gray-500 mt-2">Generated on ${new Date().toLocaleDateString()}</p>
              </div>

              <div class="mt-8 p-4 bg-gray-100 rounded-lg">
                <h3 class="font-semibold text-gray-800 mb-4">Primary Co-Benefits of Your Plan</h3>
                <p class="text-sm text-gray-600 mb-4">Implementing these actions will contribute to broader city goals.</p>
                ${benefitsHtml}
              </div>

              ${generateSectionHtml('Strategic Notes', recs.strategic_notes)}
              ${generateSectionHtml('Recommended Policy & Regulatory Actions', recs.policy)}
              ${generateSectionHtml('Recommended Design & Infrastructure Interventions', recs.design)}
              ${generateSectionHtml('Recommended Collaboration & Process Improvements', recs.collaboration)}

              <div class="mt-8 pt-6 border-t border-gray-200 text-center text-sm text-gray-500">
                <p>This action plan is developed in partnership with UN-HABITAT</p>
                <p>Supporting sustainable urban development and public health integration worldwide</p>
              </div>
            </div>

            <div id="restart-btn-container" class="mt-10 flex flex-col sm:flex-row justify-center items-center gap-4 no-print">
              <button id="download-pdf-btn" class="w-full sm:w-auto bg-blue-600 text-white font-semibold py-3 px-6 rounded-lg hover:bg-blue-700 transition-colors flex items-center justify-center">
                <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="mr-2">
                  <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"></path>
                  <polyline points="7 10 12 15 17 10"></polyline>
                  <line x1="12" y1="15" x2="12" y2="3"></line>
                </svg>
                Download PDF
              </button>
              <button id="print-btn" class="w-full sm:w-auto bg-green-600 text-white font-semibold py-3 px-6 rounded-lg hover:bg-green-700 transition-colors flex items-center justify-center">
                <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="mr-2">
                  <polyline points="6 9 6 2 18 2 18 9"></polyline>
                  <path d="M6 18H4a2 2 0 0 1-2-2v-5a2 2 0 0 1 2 2v5a2 2 0 0 1-2 2h-2"></path>
                  <rect x="6" y="14" width="12" height="8"></rect>
                </svg>
                Print Report
              </button>
              <button id="restart-btn" class="w-full sm:w-auto bg-gray-500 text-white font-semibold py-3 px-6 rounded-lg hover:bg-gray-600 transition-colors">Start Over</button>
            </div>
          `;

          // Add event listeners for the new buttons
          document.getElementById('restart-btn').addEventListener('click', () => window.location.reload());
          document.getElementById('print-btn').addEventListener('click', () => window.print());
          document.getElementById('download-pdf-btn').addEventListener('click', () => this.downloadPDF());
        },

        downloadPDF() {
          const element = document.getElementById('results-printable');
          const opt = {
            margin: 1,
            filename: `un-habitat-aedes-action-plan-${new Date().toISOString().split('T')[0]}.pdf`,
            image: { type: 'jpeg', quality: 0.98 },
            html2canvas: { scale: 2, useCORS: true },
            jsPDF: { unit: 'in', format: 'letter', orientation: 'portrait' }
          };

          // Show loading state
          const btn = document.getElementById('download-pdf-btn');
          const originalText = btn.innerHTML;
          btn.innerHTML = '<div class="animate-spin rounded-full h-5 w-5 border-b-2 border-white mr-2"></div>Generating PDF...';
          btn.disabled = true;

          html2pdf().set(opt).from(element).save().then(() => {
            // Reset button state
            btn.innerHTML = originalText;
            btn.disabled = false;
          }).catch(error => {
            console.error('PDF generation failed:', error);
            btn.innerHTML = originalText;
            btn.disabled = false;
            alert('PDF generation failed. Please try using the print function instead.');
          });
        }
      };

      app.init();
    </script>
  </body>
</html>